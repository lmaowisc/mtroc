---
title: "Multiple imputations by two-level model"
output: rmarkdown::html_vignette
vignette: >
  %\VignetteIndexEntry{Multiple imputations by two-level model}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
bibliography: references.bib
---

```{r, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

## Set-up and notation

Suppose there are $m$ studies to evaluate the diagnostic accuracy of
some test. For the $i$th study, let

-   $\mbox{TP}_i$: number of true positives
-   $\mbox{FN}_i$: number of false negatives
-   $\mbox{FP}_i$: number of false positives
-   $\mbox{TN}_i$: number of true negatives

These are the data we wish to collect for each $i=1,\ldots, m$. Write
$N_i=\mbox{TP}_i+\mbox{FN}_i$, the number of cases;
$\bar N_i=\mbox{FP}_i + \mbox{TN}_i$, the number of non-cases; and
$n_i = N_i + \bar N_i$, the total sample size.

Let $p_i$ denote the sensitivity, $q_i$ the specificity, and $\pi_i$ the
prevalence of cases in the $i$th study. If there is no missing data, we
can easily estimate them by $\hat p_i=\mbox{TP}_i/N_i$,
$\hat q_i=\mbox{TN}_i/\bar N_i$, and $\hat\pi_i=N_i/n_i$, respectively.
We can also feed the entire data
$(\mbox{TP}_i, \mbox{FN}_i, \mbox{FP}_i, \mbox{TN}_i)$ $(i=1,\ldots, m)$
into any standard software, e.g., `mada` [@mada], for meta-analysis.

## Methods

### A motivating example

Consider the scenario where there are no non-cases in some study $i$, so
$\mbox{FN}_i$, $\mbox{TN}_i=$`NA`. An example:

```{r}
library(mtroc)
uts

```

We aim to fill in the missing values of $\mbox{FN}_i$ and $\mbox{TN}_i$
by **multiple imputations (MI)**.

### Two-level random-effects models

We can think of the data as generated in two stages. First, with total
sample size $n_i$, the relative size of $N_i$ vs $\bar N_i$ is
determined by prevalence $\pi_i$. Second, given $N_i$ and $\bar N_i$,
the relative size of $\mbox{TP}_i$ vs $\mbox{FN}_i$, and that of
$\mbox{FP}_i$ vs $\mbox{TN}_i$, are determined by sensitivity $p_i$ and
specificity $q_i$, respectively. This leads us to posit a two-level
model for prevalence and for sensitivity-specificity relationship: the
first allows us to impute the size of cases or non-cases; the second to
impute specificity from sensitivity (or vice versa).


## References
